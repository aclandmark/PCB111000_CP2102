


All resets cause program control tojump to the bootloader
Note: logic is inverted. This means that
	Clearing a register reaves it containing 0xFF
	Clearing a bit leaves it as a 1
	Setting a bit leaves it as a 0


The new regime
reset_ctl_reg (0x3FC)
bit 0	POR_bit				At POR set reg to ~1		
bit 1	WDTout_bit			Read-modify-write
bit 2	Run_BL_bit			Read-modify-write
bit 3	prtD				At "r" set reg to ~8
bit 4	Flagged WDTout			Read-modify-write
bit 5	WDTout with ISR 		Read-modify-write


Apply Power 	
Prog control jumps to 0x7000
	set_POR_bit;		0x3FC = ~1	(0b1111 1110)
Prog control jumps to User app
	Clear reset_ctl_reg	0x3FC = ~0	(0b1111 1111)
Pulse Reset CTL switch	
	Set Run_BL_bit		0x3FC &= ~4	(0b1111 1011)
	SW_reset 
Prog control jumps to 0x7000
	set_WDTout_bit		0x3FC &= ~2	(0b1111 1001)
Test bits 1 and 2
  If 10 (Run_BL_bit_clear & WDTout_bit set) Jump to user app
  else
prtD.. prompt generated
Press p to program	SW_reset generated when done
prtD.. prompt repeated
Press r to run user app.
	Set prtD bit		0x3FC = ~8	(0b1111 0111)
		(clears Run_BL_bit)
	SW_reset
	set_WDTout_bit		0x3FC &= ~2	(0b1111 0101)
Test bits 1 and 2 and 
Prog control jumps to User app


Jumps to prtD... prompt





The Old regime
Apply power with Reset control switch left in the up (default) position

Program control jumps to the bootloader which: 
	Reads MCUSR (indicates POR). 
	Sets MCUSR to zero
	Executes "clear_reset_control_reg" (EEPROM 0x3FC)
	Passes control to a user application

User presses Reset control switch for 350mS and the user app:
	Executes "setRunBL_bit" (EEPROM 0x3FC bit 1)
	Triggers a WTDout

Program control jumps to the bootloader which:
	Reads MCUSR (indicates WDTout).
	Executes "setWD_RF_bit" (EEPROM 0x3FC bit 0)
	Prints the "p/r/t/D......." prompt

User presses "p" for programming:
	This terminates with a WDTout
	Restores the "p/r/t/D......." prompt

User presses "r" to run the program. Bootloader executes:
	"clear_RunBL_bit" (EEPROM 0x3FC bit 1)
	eeprom_write_byte((uint8_t*)0x3F5, 0xFF);	(clears user_prog_reset_ctl_reg)


The user program:

	Reads 0x3FC: If it equals 0xFF the reset is a POR
	Reads 0x3F5: If it equals 0xFF the program is triggered by the "p/r/t/D......." prompt	
	Clears bit 0 of the reset control register (0x3FC) after a WDTout
	Clears bit 2 of the reset control register (0x3FC) after a POR.

	Sets bit 0 of 0x3F5 when it runs for the first time
	Sets bit 2 of 0x3FC when it runs following a POR
	Sets bit 1 0f 0x3F5 for a flagged WDTout after which it clears it.
	Sets bit 2 0f 0x3F5 for a WDTout with ISR after which it clears it.
	
	
	